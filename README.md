# discordImg

# Discord Marketing System

基于 PP-ShiTuV2 + Milvus Lite 的智能 Discord 营销系统，支持自动商品抓取、图像识别和智能回复。

## 🚀 核心功能

- 📸 **智能图像识别**: 使用 PP-ShiTuV2 (MobileNetV3Small) 提取512维特征向量
- 🔍 **毫秒级检索**: Milvus Lite 向量数据库，支持7.2w+图片秒级搜索
- 🤖 **Discord 自动营销**: Selfbot 监听频道，自动回复 CNFans 购买链接
- 🌐 **现代化管理界面**: Next.js + Tailwind CSS 构建的管理后台

## 🛠️ 技术栈

| 组件 | 技术 | 说明 |
|------|------|------|
| **视觉识别** | PP-ShiTuV2 + PaddlePaddle | 使用MobileNetV3Small提取512维特征向量 |
| **向量检索** | Milvus Lite | 内积相似度搜索，支持7.2w+图片毫秒级检索 |
| **数据抓取** | 微店官方API | 直接调用thor.weidian.com API获取商品信息 |
| **翻译服务** | 百度/Google Translate API | 免费翻译API生成英文商品标题 |
| **Discord 机器人** | discord.py-self | Selfbot监听频道，自动回复CNFans链接 |
| **后端 API** | Flask | RESTful 接口服务，支持图片上传和向量搜索 |
| **前端界面** | Next.js 16 + React 19 | 现代化管理界面，支持商品规则配置 |
| **爬虫系统** | Selenium + BeautifulSoup | 微店商品信息抓取 |

## 📦 安装和运行

### 环境要求
- Python 3.8+
- Node.js 18+
- Chrome 浏览器 (用于网页抓取)

### 后端安装

```bash
cd backend
pip install -r requirements.txt
```

### 前端安装

```bash
cd frontend
npm install
```

### 启动服务

```bash
# 方式1: 使用脚本启动
./scripts/run.sh

# 方式2: 分别启动
# 终端1: 启动后端
cd backend && python app.py

# 终端2: 启动前端
cd frontend && npm run dev
```

访问地址：
- **前端界面**: http://localhost:3000
- **后端 API**: http://localhost:5001

## ✨ 核心特性

- 🔤 **智能翻译**: 自动调用免费翻译API生成英文商品标题
- 🎯 **一键设置**: 新商品自动启用回复规则，支持关键词匹配
- ⚙️ **灵活配置**: 支持为每个商品单独配置自动回复规则
- 🆔 **完整信息**: 显示微店商品ID、标题、英文标题、图片数量等
- 🔍 **智能搜索**: 以图搜图功能，支持相似度阈值设置和历史记录
- 🌐 **官方API**: 直接调用微店官方接口，稳定可靠

## 🎯 使用指南

### 1. 配置 Discord 账号和全局设置
1. 进入"账号与规则"页面
2. 点击"添加账号"，输入 Discord Token
3. 切换账号状态为"在线"
4. 配置账号轮换设置（可选）
5. 配置"账号轮换"设置（可选）

### 2. 添加商品到库
1. 进入"微店抓取"页面
2. 输入微店商品URL（如: https://weidian.com/item.html?itemID=7622495468）
3. 点击"建立索引与规则"按钮
4. 系统自动：
   - 调用微店官方API获取商品信息
   - 使用免费翻译API生成英文标题
   - 提取商品标题和图片链接
   - 下载高清商品图片到本地
   - 提取 PP-ShiTuV2 图像特征向量
   - 建立 Milvus Lite 向量索引
   - **自动启用**自动回复规则（支持关键词匹配）

### 3. 配置自动回复规则
1. 点击商品列表中的编辑按钮
2. 设置匹配关键词和回复规则
3. 启用"自动回复规则"

### 4. 测试图像搜索
1. 进入"以图搜图"页面
2. 上传商品图片
3. 系统显示相似度最高的匹配结果

## 🔧 高级配置

### 相似度阈值
- 默认阈值: 75%
- 可在系统设置中调整
- 建议值: 电商场景 70-80%，内容识别 80-90%

### 自动回复
- 支持关键词精确匹配和模糊匹配
- 可配置不回复回复消息和@消息
- 支持为每个商品单独设置规则

### 爬虫配置
- 支持 Selenium 和 requests 双模式
- 自动处理反爬虫机制
- 支持多线程图片下载

## 📊 性能指标

- **图像处理**: 单张图片 < 200ms
- **向量检索**: 7.2w图片库 < 50ms
- **相似度精度**: > 95% (在测试数据集上)
- **内存占用**: < 2GB (Milvus Lite 优化)

## 🐛 故障排除

### 常见问题

**Q: 爬虫无法获取商品信息**
A: 检查网络连接，或尝试使用代理IP

**Q: 图像特征提取失败**
A: 确保 PaddleClas 正确安装，检查 CUDA 环境

**Q: Discord 连接失败**
A: 确认 Token 有效性，避免频繁切换账号

**Q: 向量搜索无结果**
A: 检查相似度阈值设置，尝试降低阈值

### 日志查看
- 后端日志: 查看终端输出
- 前端日志: 浏览器开发者工具控制台

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

Apache 2.0 License
# discordImg
